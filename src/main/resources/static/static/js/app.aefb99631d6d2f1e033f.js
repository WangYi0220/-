webpackJsonp([1],{"+oU4":function(e,t){},"0/7L":function(e,t){},"2C74":function(e,t){},"4ml/":function(e,t){},K2Lm:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("7+uW"),n={name:"mHeader",props:{title:{type:String,default:""}}},i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"mHeader"},[t("h4",[this._v(this._s(this.title))])])},staticRenderFns:[]};var r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mFooter"},[s("div",{staticClass:"item"},[s("router-link",{attrs:{to:"/"}},[s("i",{staticClass:"iconfont icon-conversation_icon"}),e._v(" "),s("span",[e._v("聊天")])])],1),e._v(" "),s("div",{staticClass:"item"},[s("router-link",{attrs:{to:"/friends"}},[s("i",{staticClass:"iconfont icon-tongxunlu"}),e._v(" "),s("span",[e._v("通讯录")])])],1),e._v(" "),s("div",{staticClass:"item"},[s("router-link",{attrs:{to:"/add"}},[s("i",{staticClass:"iconfont icon-tuanduicankaoxian-"}),e._v(" "),s("span",[e._v("添加")])])],1),e._v(" "),s("div",{staticClass:"item"},[s("router-link",{attrs:{to:"/user"}},[s("i",{staticClass:"iconfont icon-weibiaoti2fuzhi12"}),e._v(" "),s("span",[e._v("我的")])])],1)])},staticRenderFns:[]};var o={name:"App",components:{mHeader:s("VU/8")(n,i,!1,function(e){s("UUdz")},"data-v-9fd6081a",null).exports,mFooter:s("VU/8")({name:"mFooter"},r,!1,function(e){s("K2Lm")},"data-v-07df0fdc",null).exports}},c={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("m-header",{directives:[{name:"show",rawName:"v-show",value:this.$route.meta.isCommonShow,expression:"$route.meta.isCommonShow"}],attrs:{title:this.$route.meta.title}}),this._v(" "),t("router-view"),this._v(" "),t("m-footer",{directives:[{name:"show",rawName:"v-show",value:this.$route.meta.isCommonShow,expression:"$route.meta.isCommonShow"}]})],1)},staticRenderFns:[]};var l=s("VU/8")(o,c,!1,function(e){s("0/7L")},null,null).exports,u=s("/ocq"),m=s("mtWM"),f=s.n(m),d=s("Fd2+"),p={name:"home",data:function(){return{userID:JSON.parse(sessionStorage.getItem("user")).userID,friendsList:[]}},methods:{},created:function(){var e=this;f.a.get("/cryptolalia/user/list/"+this.userID+"/1").then(function(t){console.log(t.data),0!=t.data.length&&(e.friendsList=t.data)})},destroyed:function(){}},v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"home"},[s("div",{staticClass:"content"},[0!=e.friendsList.length?s("ul",{staticClass:"chat-list"},e._l(e.friendsList,function(t,a){return s("li",{key:a,staticClass:"chat-list-item"},[s("router-link",{attrs:{to:{path:"/chatRoom",query:{peerID:t.userID,nickname:t.nickname}}}},[s("div",{staticClass:"avatar"},[s("img",{attrs:{src:"/cryptolalia/img/"+t.headImg,width:"45",height:"45",alt:""}})]),e._v(" "),s("div",{staticClass:"info"},[s("p",{staticClass:"nickname"},[e._v(e._s(t.nickname))]),e._v(" "),s("p",{staticClass:"chats"},[e._v("HelloWord")])])])],1)}),0):s("div",{staticClass:"noFriends"},[s("p",[e._v("暂无好友")])])])])},staticRenderFns:[]};var h=s("VU/8")(p,v,!1,function(e){s("i82a")},"data-v-19d18784",null).exports,g=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.href)||[,""])[1].replace(/\+/g,"%20"))||null},_=s("NYxO");a.a.use(_.a);var C={messageList:[]},k={getMessages:function(){return C.messageList}},w={getMessages:function(e,t){e.messageList.push(t),console.log(e.messageList)}},b=new _.a.Store({state:C,getters:k,actions:{getMessages:function(e,t){e.commit("getMessages",t)}},mutations:w}),I=null,y={initWebSocket:function(e){(I=new WebSocket("ws://192.168.22.71/cryptolalia/websocket/"+e)).onopen=this.websocketonopen,I.onerror=this.websocketonerror,I.onmessage=this.websocketonmessage,I.close=this.websocketclose},websocketonopen:function(){console.log("连接成功")},websocketonerror:function(e){Toast.fail("WebSocket连接发生错误")},websocketonmessage:function(e){var t=e.data.split("?"),s={userID:t[1],message:t[0]};""!=t[0]&&b.dispatch("getMessages",s)},websocketsend:function(e){I.send(e),console.log(e)},websocketclose:function(e){console.log("关闭")}},S={name:"chatRoom",data:function(){return{userID:JSON.parse(sessionStorage.getItem("user")).userID,userAcavtar:JSON.parse(sessionStorage.getItem("user")).headImg,peerID:g("peerID"),nickname:g("nickname"),message:"",peerMessage:""}},methods:{sendMessage:function(){if(""!=this.message){var e=this.message+"?"+this.peerID;y.websocketsend(e);var t={userID:this.userID,peerID:this.peerID,message:this.message};this.$store.dispatch("getMessages",t),this.message=""}else d.a.fail("请输入发送的内容")},goBack:function(){history.go(-1)}},computed:{getMessage:function(){return this.$store.getters.getMessages}},watch:{}},x={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chatRoom"},[s("div",{staticClass:"header"},[s("div",{staticClass:"header-item"},[s("i",{staticClass:"iconfont icon-fanhui",on:{click:e.goBack}})]),e._v(" "),s("div",{staticClass:"header-item",staticStyle:{"text-align":"center"}},[e._v("\n            "+e._s(e.nickname)+"\n        ")]),e._v(" "),e._m(0)]),e._v(" "),s("div",{staticClass:"content"},e._l(e.getMessage,function(t,a){return s("ul",{key:a,ref:"chatContent",refInFor:!0,attrs:{id:"chatContent"}},[t.userID==e.peerID?s("li",{staticClass:"chat-peer"},[e._m(1,!0),e._v(" "),s("div",{staticClass:"chat-peer-content"},[s("span",{staticClass:"left"}),e._v(" "),s("p",{staticStyle:{"max-width":"200px"}},[e._v(e._s(t.message))])])]):e._e(),e._v(" "),t.userID==e.userID&&t.peerID==e.peerID?s("li",{staticClass:"chat-me"},[s("div",{staticClass:"chat-me-content"},[s("span",{staticClass:"right"}),e._v(" "),s("p",{staticStyle:{"max-width":"200px"}},[e._v(e._s(t.message))])]),e._v(" "),e._m(2,!0)]):e._e()])}),0),e._v(" "),s("div",{staticClass:"footer"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],attrs:{type:"text",name:""},domProps:{value:e.message},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t)},input:function(t){t.target.composing||(e.message=t.target.value)}}}),e._v(" "),s("button",{attrs:{type:"button"},on:{click:e.sendMessage}},[e._v("发送")])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"header-item",staticStyle:{"text-align":"right"}},[t("i",{staticClass:"iconfont icon-gengduo-copy"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"acatar-peer"},[t("img",{attrs:{src:s("fhlz"),width:"30",height:"30",alt:""}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"acavtar-me"},[t("img",{attrs:{src:s("lNlC"),width:"30",height:"30",alt:""}})])}]};var $=s("VU/8")(S,x,!1,function(e){s("U32m")},"data-v-2163f5bf",null).exports,D={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"friends"},[this._v("\n    friends\n")])},staticRenderFns:[]};var E=s("VU/8")({name:"friends"},D,!1,function(e){s("2C74")},"data-v-58f4d872",null).exports,F={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"user"},[this._v("\n    user\n")])},staticRenderFns:[]};var U=s("VU/8")({name:"user"},F,!1,function(e){s("+oU4")},"data-v-17bd9171",null).exports,R=s("mvHQ"),N=s.n(R),M={name:"login",data:function(){return{loginInfo:{username:"",password:""}}},methods:{login:function(){var e=this,t=new FormData(this.$refs.login_from);this.$server.login(t).then(function(t){if(t){d.a.success("登陆成功"),sessionStorage.setItem("user",N()(t));var s=JSON.parse(sessionStorage.getItem("user")).userID;y.initWebSocket(s),e.$router.push({path:"/"})}else d.a.fail("用户名或者密码错误")})}}},L={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login"},[s("div",{staticClass:"content"},[s("h2",{staticClass:"title"},[e._v("登陆密语聊天室")]),e._v(" "),s("form",{ref:"login_from"},[s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.loginInfo.username,expression:"loginInfo.username"}],attrs:{type:"text",name:"username",placeholder:"请输入用户名"},domProps:{value:e.loginInfo.username},on:{input:function(t){t.target.composing||e.$set(e.loginInfo,"username",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.loginInfo.password,expression:"loginInfo.password"}],attrs:{type:"password",name:"password",placeholder:"请输入密码"},domProps:{value:e.loginInfo.password},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login(t)},input:function(t){t.target.composing||e.$set(e.loginInfo,"password",t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group"},[s("button",{staticClass:"btn",attrs:{type:"button"},on:{click:e.login}},[e._v("登陆")])]),e._v(" "),s("div",{staticClass:"form-group"},[s("p",[e._v("\n                    如果还没拥有账号，请前往\n                    "),s("router-link",{attrs:{to:"/register"}},[e._v("注册")])],1)])])])])},staticRenderFns:[]};var O=s("VU/8")(M,L,!1,function(e){s("XSta")},"data-v-0ce19ac0",null).exports,V={name:"login",methods:{register:function(){var e=new FormData(this.$refs.register_from);this.$server.register(e).then(function(e){e?d.a.success("注册成功"):d.a.fail("注册失败")})}}},W={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"register"},[s("div",{staticClass:"content"},[s("h2",{staticClass:"title"},[e._v("欢迎注册密语聊天室")]),e._v(" "),s("form",{ref:"register_from"},[e._m(0),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),s("div",{staticClass:"form-group"},[s("button",{staticClass:"btn",attrs:{type:"button"},on:{click:e.register}},[e._v("注册")])]),e._v(" "),s("div",{staticClass:"form-group"},[s("p",[e._v("\n                    如果还没拥有账号，请前往\n                    "),s("router-link",{attrs:{to:"/login"}},[e._v("登陆")])],1)])])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"form-group"},[t("input",{attrs:{type:"text",name:"username",placeholder:"请输入用户名"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"form-group"},[t("input",{attrs:{type:"text",name:"nickname",placeholder:"请输入昵称"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"form-group"},[t("input",{attrs:{type:"tel",maxlength:"11",name:"phone",placeholder:"请输入电话"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"form-group"},[t("input",{attrs:{type:"password",name:"password",placeholder:"请输入密码"}})])}]};var H=s("VU/8")(V,W,!1,function(e){s("yCK8")},"data-v-439b1e68",null).exports,J={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"add"},[this._v("\n    add\n")])},staticRenderFns:[]};var z=s("VU/8")({name:"add"},J,!1,function(e){s("xWdZ")},"data-v-2375240a",null).exports;a.a.use(u.a);var A=new u.a({routes:[{path:"/",name:"home",component:h,meta:{title:"聊天室",isCommonShow:!0}},{path:"/friends",name:"friends",component:E,meta:{title:"通讯录",isCommonShow:!0}},{path:"/user",name:"user",component:U,meta:{title:"我的",isCommonShow:!0}},{path:"/add",name:"add",component:z,meta:{title:"好友添加",isCommonShow:!0}},{path:"/chatRoom",name:"chatRoom",component:$,meta:{isCommonShow:!1}},{path:"/register",name:"register",component:H,meta:{isCommonShow:!1}},{path:"/login",name:"login",component:O,meta:{isCommonShow:!1}}]}),K=(s("4ml/"),s("//Fk")),P=s.n(K);f.a.interceptors.request.use(function(e){return e},function(e){return d.a.fail({message:"请求超时!"}),P.a.resolve(e)}),f.a.interceptors.response.use(function(e){return e},function(e){if(e&&e.response)switch(e.response.status){case 400:d.a.fail("错误请求");break;case 401:d.a.fail("未授权，请重新登录");break;case 403:d.a.fail("拒绝访问");break;case 404:d.a.fail("请求错误,未找到该资源");break;case 405:d.a.fail("请求方法未允许");break;case 408:d.a.fail("请求超时");break;case 500:d.a.fail("服务器端出错");break;case 501:d.a.fail("网络未实现");break;case 502:d.a.fail("网络错误");break;case 503:d.a.fail("服务不可用");break;case 504:d.a.fail("网络超时");break;case 505:d.a.fail("http版本不支持该请求");break;default:d.a.fail("连接错误"+e.response.status)}else d.a.fail("连接到服务器失败");return P.a.resolve(e)});function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new P.a(function(s,a){f.a.post(e,t).then(function(e){s(e.data)},function(e){a(e)})})}var B={login:function(e){return q("/cryptolalia/user/login",e)},register:function(e){return q("/cryptolalia/user/register",e)}};if(a.a.config.productionTip=!1,a.a.use(d.b),A.beforeEach(function(e,t,s){"/login"==e.path&&sessionStorage.removeItem("user");var a=JSON.parse(sessionStorage.getItem("user"));"/register"==e.path?s():a||"/login"==e.path?s():s({path:"/login"})}),a.a.prototype.$server=B,sessionStorage.getItem("user")){var T=JSON.parse(sessionStorage.getItem("user")).userID;y.initWebSocket(T)}new a.a({el:"#app",router:A,store:b,components:{App:l},template:"<App/>"})},U32m:function(e,t){},UUdz:function(e,t){},XSta:function(e,t){},fhlz:function(e,t,s){e.exports=s.p+"static/img/avatar-peer.3d53419.png"},i82a:function(e,t){},lNlC:function(e,t,s){e.exports=s.p+"static/img/avatar-default.4b174fc.png"},xWdZ:function(e,t){},yCK8:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.aefb99631d6d2f1e033f.js.map